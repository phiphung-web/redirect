<!DOCTYPE html>
<html lang="vi">
<head>
    <title>Logs - <%= camp.name %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">
    <div class="container bg-white p-4 rounded shadow-sm">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">Lịch sử log: <span class="text-primary"><%= camp.name %></span></h4>
            <a href="/campaigns/<%= camp.id %>/report" class="btn btn-outline-secondary btn-sm">Quay lại báo cáo</a>
        </div>
        <form class="row g-2 mb-3" method="GET">
            <div class="col-auto">
                <label class="form-label">Action</label>
                <select name="action" class="form-select form-select-sm" onchange="this.form.submit()">
                    <option value="" <%= !action ? 'selected' : '' %>>Tất cả</option>
                    <option value="redirect" <%= action==='redirect' ? 'selected' : '' %>>redirect</option>
                    <option value="safe_page" <%= action==='safe_page' ? 'selected' : '' %>>safe_page</option>
                    <option value="safe_page_wrong_country" <%= action==='safe_page_wrong_country' ? 'selected' : '' %>>wrong_country</option>
                    <option value="safe_page_missing_param" <%= action==='safe_page_missing_param' ? 'selected' : '' %>>missing_param</option>
                </select>
            </div>
            <div class="col-auto">
                <label class="form-label">Số dòng</label>
                <input type="number" name="limit" value="<%= limit %>" min="50" max="2000" class="form-control form-control-sm">
            </div>
            <div class="col-auto align-self-end">
                <button class="btn btn-primary btn-sm" type="submit">Lọc</button>
            </div>
        </form>
        <div class="table-responsive">
            <table class="table table-sm table-striped table-hover">
                <thead class="table-dark"><tr><th>Thời gian</th><th>IP</th><th>Quốc gia</th><th>Thiết bị/OS</th><th>Action</th><th>Referer</th></tr></thead>
                <tbody>
                    <% if(logs.length===0) { %><tr><td colspan="6" class="text-center text-muted">Không có log</td></tr><% } %>
                    <% logs.forEach(l => { %>
                        <tr>
                            <td><%= new Date(l.created_at).toLocaleString('vi-VN',{timeZone:'Asia/Ho_Chi_Minh'}) %></td>
                            <td class="font-monospace"><%= l.ip %></td>
                            <td><%= l.country || '-' %></td>
                            <td><%= l.device_type || 'PC' %> / <%= l.os_name || 'Unknown' %></td>
                            <td><%= l.action %></td>
                            <td class="text-truncate" style="max-width:200px" title="<%= l.referer %>"><%= l.referer || '-' %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
