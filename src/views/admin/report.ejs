<!DOCTYPE html>
<html lang="vi">
<head>
    <title>B√°o c√°o - <%= camp.name %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-log td { font-size: 0.85rem; vertical-align: middle; }
        .badge-status { min-width: 60px; }
    </style>
</head>
<body class="bg-light p-4">
    <div class="container bg-white p-4 rounded shadow-sm">
        <div class="d-flex justify-content-between mb-4">
            <h3>üìä B√°o c√°o: <span class="text-primary"><%= camp.name %></span></h3>
            <a href="/domains/<%= camp.domain_id %>" class="btn btn-outline-secondary">Quay l·∫°i</a>
        </div>

        <div class="row mb-5">
            <div class="col-md-12">
                <h5 class="border-bottom pb-2">Traffic 7 ng√†y qua</h5>
                <table class="table table-bordered text-center">
                    <thead class="table-light">
                        <th>Ng√†y</th>
                        <th class="text-success">Redirect (Pass)</th>
                        <th class="text-danger">Safe Page (Fail)</th>
                    </thead>
                    <tbody>
                        <% if(stats.length === 0) { %>
                            <tr><td colspan="3">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>
                        <% } %>
                        <% stats.forEach(s => { %>
                            <tr>
                                <td><%= new Date(s.day).toLocaleDateString('vi-VN') %></td>
                                <td class="text-success fw-bold fs-5"><%= s.redirects || 0 %></td>
                                <td class="text-danger fw-bold fs-5"><%= s.safe || 0 %></td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <h5 class="border-bottom pb-2">üìã Nh·∫≠t k√Ω truy c·∫≠p (100 l∆∞·ª£t m·ªõi nh·∫•t)</h5>
        <div class="table-responsive">
            <table class="table table-sm table-striped table-hover table-log">
                <thead class="table-dark">
                    <tr>
                        <th>Th·ªùi gian (VN)</th>
                        <th>IP</th>
                        <th>Qu·ªëc gia</th>
                        <th>Thi·∫øt b·ªã / OS</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Chi ti·∫øt l·ªói</th>
                        <th>Referer</th>
                    </tr>
                </thead>
                <tbody>
                    <% logs.forEach(log => { %>
                        <tr>
                            <td><%= new Date(log.created_at).toLocaleString('vi-VN', { timeZone: 'Asia/Ho_Chi_Minh' }) %></td>
                            
                            <td><span class="font-monospace"><%= log.ip %></span></td>
                            
                            <td><span class="badge bg-info text-dark"><%= log.country %></span></td>
                            
                            <td>
                                <% if(log.device_type || log.os_name) { %>
                                    <%= log.device_type || 'PC' %> / <%= log.os_name || 'Unknown' %>
                                <% } else { %>
                                    <span class="text-muted">-</span>
                                <% } %>
                            </td>
                            
                            <td>
                                <% if(log.action === 'redirect') { %>
                                    <span class="badge bg-success badge-status">PASS</span>
                                <% } else { %>
                                    <span class="badge bg-danger badge-status">FAIL</span>
                                <% } %>
                            </td>

                            <td>
                                <% if(log.action === 'redirect') { %>
                                    <span class="text-success small">Chuy·ªÉn h∆∞·ªõng OK</span>
                                <% } else if (log.action === 'safe_page_inactive') { %>
                                    <span class="text-warning small">Link ƒëang T·∫Øt</span>
                                <% } else if (log.action === 'safe_page_wrong_country') { %>
                                    <span class="text-danger small">Sai Qu·ªëc gia</span>
                                <% } else if (log.action === 'safe_page_wrong_params' || log.action === 'safe_page_missing_param') { %>
                                    <span class="text-danger small">Thi·∫øu/Sai Tham s·ªë</span>
                                <% } else { %>
                                    <span class="text-muted small">V√†o trang s·∫°ch</span>
                                <% } %>
                            </td>

                            <td class="text-truncate" style="max-width: 150px;" title="<%= log.referer %>">
                                <%= log.referer || '-' %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>